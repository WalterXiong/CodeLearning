import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o,c,b as n,d as s,e as u,f as a}from"./app-422b0c18.js";const l={},i=a(`<h1 id="jvm-å†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#jvm-å†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸" aria-hidden="true">#</a> JVM - å†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸</h1><h2 id="è¿è¡Œæ—¶æ•°æ®åŒº" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œæ—¶æ•°æ®åŒº" aria-hidden="true">#</a> è¿è¡Œæ—¶æ•°æ®åŒº</h2><p>ç®€å›¾ï¼š</p><h3 id="_1-ç¨‹è®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#_1-ç¨‹è®¡æ•°å™¨" aria-hidden="true">#</a> 1. ç¨‹è®¡æ•°å™¨</h3><p>program counter registerï¼Œ</p><p>æ­¤å†…å­˜åŒºåŸŸæ˜¯ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• OOM<code> (OutOfMemoryError)</code>çš„åŒºåŸŸ</p><h3 id="_2-è™šæ‹Ÿæœºæ ˆ" tabindex="-1"><a class="header-anchor" href="#_2-è™šæ‹Ÿæœºæ ˆ" aria-hidden="true">#</a> 2. è™šæ‹Ÿæœºæ ˆ</h3><p>æ ˆä¸­åŸºæœ¬çš„å•ä½æ˜¯æ ˆå¸§ï¼Œæ ˆå¸§åŒ…å«ï¼šæ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨ã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€‚è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³•æœåŠ¡ã€‚</p><h3 id="_3-æœ¬åœ°æ–¹æ³•æ ˆ" tabindex="-1"><a class="header-anchor" href="#_3-æœ¬åœ°æ–¹æ³•æ ˆ" aria-hidden="true">#</a> 3. æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ï¼ˆNativeï¼‰æ–¹æ³•æœåŠ¡</p><h3 id="_4-å †ç©ºé—´" tabindex="-1"><a class="header-anchor" href="#_4-å †ç©ºé—´" aria-hidden="true">#</a> 4. å †ç©ºé—´</h3><p>ä¹Ÿæˆä¸º GCï¼ˆGarbage Collected Hopï¼‰å † ï¼›Java ä¸­ï¼Œâ€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åœ¨å †ä¸Š</p><p>å­—ç¬¦ä¸²å¸¸é‡æ± </p><p>é™æ€å¸¸é‡</p><h3 id="_5-æ–¹æ³•åŒº" tabindex="-1"><a class="header-anchor" href="#_5-æ–¹æ³•åŒº" aria-hidden="true">#</a> 5. æ–¹æ³•åŒº</h3><h3 id="_6-è¿è¡Œæ—¶å¸¸é‡æ± l" tabindex="-1"><a class="header-anchor" href="#_6-è¿è¡Œæ—¶å¸¸é‡æ± l" aria-hidden="true">#</a> 6. è¿è¡Œæ—¶å¸¸é‡æ± L</h3><h3 id="_7-ç›´æ¥å†…å­˜" tabindex="-1"><a class="header-anchor" href="#_7-ç›´æ¥å†…å­˜" aria-hidden="true">#</a> 7. ç›´æ¥å†…å­˜</h3><h2 id="hotspot-è™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜" tabindex="-1"><a class="header-anchor" href="#hotspot-è™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜" aria-hidden="true">#</a> Hotspot è™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜</h2><h3 id="_1-å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" aria-hidden="true">#</a> 1. å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h3><h4 id="step1-ç±»çš„åŠ è½½æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#step1-ç±»çš„åŠ è½½æ£€æŸ¥" aria-hidden="true">#</a> step1ï¼šç±»çš„åŠ è½½æ£€æŸ¥</h4><p>è™šæ‹Ÿæœºåœ¨æ”¶åˆ°ä¸€ä¸ª new æŒ‡ä»¤ä¹‹åï¼Œä¼šé¦–å…ˆæ£€æŸ¥æŒ‡ä»¤å¸¦çš„å‚æ•°åœ¨å¸¸é‡æ± ä¸­æ˜¯å¦èƒ½å¤Ÿå®šä½åˆ°è¿™ä¸ªç±»çš„çš„ç¬¦å·å¼•ç”¨ï¼Œç„¶åæ ¹æ®ç¬¦å·å¼•ç”¨æ£€æŸ¥è¿™ä¸ªç¬¦å·åº”ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ã€è§£æã€åˆå§‹åŒ–è¿‡ï¼›å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±<strong>å¿…é¡»</strong>æ‰§è¡Œ==ç±»åŠ è½½çš„è¿‡ç¨‹==ã€‚</p><h4 id="step2-å†…å­˜åˆ†é…" tabindex="-1"><a class="header-anchor" href="#step2-å†…å­˜åˆ†é…" aria-hidden="true">#</a> step2ï¼šå†…å­˜åˆ†é…</h4><p>åœ¨ç±»çš„åŠ è½½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºä¼šä¸ºæ–°ç”Ÿæˆçš„å¯¹è±¡åˆ†é…å†…å­˜ã€‚</p><p>è™šæ‹Ÿæœºä¸ºå¯¹è±¡åˆ†é…å†…å­˜çš„æ–¹å¼ï¼Œå°±å¥½æ¯”ä» Java å †å†…å­˜ä¸­åˆ’åˆ†å‡ºä¸€å—ç¡®å®šå¤§å°çš„åŒºåŸŸå‡ºæ¥ç»™è¯¥å¯¹è±¡ï¼Œè€Œå†…å­˜åˆ†é…ç®—æ³•æœ‰ä¸¤ç§ï¼š<code>æŒ‡é’ˆç¢°æ’æ³•</code>ï¼Œ<code>ç©ºé—²åˆ—è¡¨æ³•</code>ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨å“ªç§åˆ†é…ç®—æ³•æ˜¯ç”±å †ç©ºé—´ä¸­å†…å­˜æ˜¯å¦è§„æ•´ï¼ˆæ•´é½ï¼‰å†³å®šçš„ï¼Œè€Œå¯¹ç©ºé—´ä¸­çš„å†…å­˜åˆ†å¸ƒæ˜¯å¦è§„æ•´åˆæ˜¯ç”±æ”¹è™šæ‹Ÿæœºæ‰€æ­è½½çš„ç®¡ç†å †å†…å­˜çš„åƒåœ¾å›æ”¶å™¨æ˜¯å¦å…·æœ‰æ ‡è®°æ•´ç†èƒ½åŠ›å†³å®šçš„ã€‚</p><ul><li>æŒ‡é’ˆç¢°æ’ <ul><li>é€‚åˆäºå †å†…å­˜è§„æ•´çš„æƒ…å†µã€‚</li><li>å‡è®¾ Java å †å†…å­˜ç»å¯¹è§„æ•´ï¼ˆæ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼‰ï¼Œå°†å·²ç»åˆ’åˆ†ç»™åˆ«çš„å¯¹è±¡ï¼ˆå·²ä½¿ç”¨ï¼‰çš„å†…å­˜åˆ†åˆ°ä¸€è¾¹ï¼Œå°†å…¶ä»–è¿˜æ²¡æœ‰ä½¿ç”¨çš„ï¼ˆç©ºé—²ï¼‰çš„å†…å­˜æ”¾åˆ°å¦å¤–ä¸€è¾¹ï¼Œå·²ä½¿ç”¨å’Œç©ºé—²å†…å­˜çš„é›¶ç•Œç‚¹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåˆ†é…å†…å­˜çš„æ—¶å€™å°±æ˜¯å°†è¯¥æŒ‡é’ˆå‘ç€ç©ºé—²çš„é‚£è¾¹ç§»åŠ¨éœ€è¦åˆ†é…çš„å¯¹è±¡å¤§å°çš„ç›¸ç­‰çš„è·ç¦»ã€‚</li><li>æ­è½½è¯¥åˆ†é…ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ï¼š<code>Serial</code>ã€<code>NewPar</code>ã€‚</li></ul></li><li>ç©ºé—²åˆ—è¡¨ <ul><li>é€‚åˆå †å†…å­˜ä¸è§„æ•´ï¼Œå­˜åœ¨å†…å­˜ç¢ç‰‡çš„æƒ…å†µã€‚</li><li>å› ä¸º Java å †å†…å­˜ä¸­å†…å­˜åˆ†é…ä¸æ˜¯è¿ç»­çš„ï¼Œå­˜åœ¨å†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºè‡ªå·±ä¼šç»´æŠ¤ä¸€å¼ å†…å­˜ç©ºé—´åœ°å€å’Œå¯¹è±¡çš„è¡¨ï¼Œåœ¨åˆ†é…å†…å­˜çš„æ—¶å€™éœ€è¦ä»å†…å­˜ä¸­è°ƒä¸€å—ç©ºé—²çš„å†…å­˜ç©ºé—´åˆ†é…ç»™å¯¹åº”çš„å¯¹è±¡ï¼Œç„¶åè‡ªå·±åœ¨ç»´æŠ¤æ›´æ–°è¿™å¼ åœ°å€è¡¨ï¼Œæ‰€ä»¥å«ç©ºé—²åˆ—è¡¨ã€‚</li><li>æ­è½½è¯¥åˆ†é…ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ï¼š<code>CMS</code>ã€‚</li></ul></li></ul><p>==// todo è¿™é‡Œè¿˜æ²¡å†™ï¼ˆTLABï¼‰==</p><h4 id="step3-åˆå§‹åŒ–é›¶å€¼" tabindex="-1"><a class="header-anchor" href="#step3-åˆå§‹åŒ–é›¶å€¼" aria-hidden="true">#</a> step3ï¼šåˆå§‹åŒ–é›¶å€¼</h4><p>åˆ†é…åˆ°åˆé€‚çš„å†…å­˜ç©ºé—´ä¹‹åï¼Œè™šæ‹Ÿå¿…é¡»å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´ï¼ˆä½†ä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰è¿›è¡Œåˆå§‹åŒ–é›¶å€¼ï¼Œè¿™ä¸€æ­¥çš„æ“ä½œä¿è¯å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¿è¯ç¨‹åºä»£ç èƒ½å¤Ÿç›´æ¥è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹å¯¹åº”çš„é›¶å€¼ã€‚</p><h4 id="step4-è®¾ç½®å¯¹è±¡å¤´" tabindex="-1"><a class="header-anchor" href="#step4-è®¾ç½®å¯¹è±¡å¤´" aria-hidden="true">#</a> step4ï¼šè®¾ç½®å¯¹è±¡å¤´</h4><p>ï¼ˆ<strong>Object Header</strong>ï¼‰æ¥ä¸‹æ¥ï¼Œè™šæ‹Ÿæœºè¿˜è¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®å¯¹è±¡å¤´çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šå¯¹è±¡æ˜¯å±äºå“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„ <code>Hash</code> ç ã€å¯¹è±¡çš„ <code>GC</code> åˆ†å¸¦å¹´é¾„ä¿¡æ¯ç­‰ï¼Œè¿™äº›ä¿¡æ¯éƒ½å­˜åœ¨å¯¹è±¡å¤´ä¸­ã€‚è¿˜æœ‰ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼Œä¼šè®¾ç½®é”çš„ä¿¡æ¯ï¼ˆåé¢ä¼šè¯´åˆ°ï¼‰ã€‚</p><h4 id="step5-æ‰§è¡Œ-init-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#step5-æ‰§è¡Œ-init-æ–¹æ³•" aria-hidden="true">#</a> step5ï¼šæ‰§è¡Œ <code>&lt;init&gt;</code> æ–¹æ³•</h4><p>åˆ°è¿™é‡Œåœ¨è™šæ‹Ÿæœºçš„è§’åº¦ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªæ–°å¯¹è±¡å°±å·²ç»äº§ç”Ÿäº†ï¼Œä½†æ˜¯ç«™åœ¨ Java ä»£ç çš„è§’åº¦ä¸Šæ¥è¯´å¯¹è±¡çš„åˆ›å»ºæ‰åˆšåˆšå¼€å§‹ â€”â€” æ„é€ å‡½æ•°ï¼ˆClass æ–‡ä»¶ä¸­çš„ <code>&lt;init&gt;()</code> æ–¹æ³•ï¼‰è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜æ˜¯é»˜è®¤çš„é›¶å€¼ã€‚ä¸€èˆ¬æ¥è¯´åœ¨ new æŒ‡ä»¤åä¼šæ¥ç€æ‰§è¡Œ <code>&lt;init&gt;()</code>ï¼ŒæŒ‰ç…§ç¨‹åºçŒ¿çš„æƒ³æ³•å¯¹å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ°è¿™æ—¶å€™ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—æ˜¯è¢«å®Œå…¨æ„é€ å‡ºæ¥ã€‚</p><h3 id="_2-å¯¹è±¡çš„å†…å­˜å¸ƒå±€" tabindex="-1"><a class="header-anchor" href="#_2-å¯¹è±¡çš„å†…å­˜å¸ƒå±€" aria-hidden="true">#</a> 2. å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3><p>åœ¨ HotSpot è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„å­˜å‚¨å¸ƒå±€å¯åˆ†ä¸ºä¸‰ç±»ï¼šå¯¹è±¡å¤´ï¼ˆObject Headerï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰ã€å¯¹å…¶å¡«å……ï¼ˆPaddingï¼‰ã€‚</p><p>HotSpot ä¸­å¯¹è±¡å¤´ä¸»è¦åŒ…å«ä¸¤ç±»æ•°æ®ï¼š</p><ul><li>ç¬¬ä¸€ç±»æ˜¯ï¼š==<strong>å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®</strong>==ï¼Œ</li><li>å¦ä¸€ç±»æ˜¯ï¼š==<strong>ç±»å‹æŒ‡é’ˆ</strong>==ï¼Œ</li></ul><p>==// todo è¿™é‡Œè¿˜æ²¡å†™==</p><h3 id="_3-å¯¹è±¡çš„è®¿é—®å®šä½" tabindex="-1"><a class="header-anchor" href="#_3-å¯¹è±¡çš„è®¿é—®å®šä½" aria-hidden="true">#</a> 3. å¯¹è±¡çš„è®¿é—®å®šä½</h3><p>==// todo è¿™é‡Œè¿˜æ²¡å†™==</p><h2 id="outofmemoryerror-å¼‚å¸¸éªŒè¯" tabindex="-1"><a class="header-anchor" href="#outofmemoryerror-å¼‚å¸¸éªŒè¯" aria-hidden="true">#</a> OutOfMemoryError å¼‚å¸¸éªŒè¯</h2><p>åœ¨ ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­ï¼Œä»…æœ‰é™¤äº†ç¨‹åºè®¡æ•°å™¨æ„å¤–ï¼Œè™šæ‹Ÿæœºå…¶ä»–çš„å‡ ä¸ªè¿è¡Œæ—¶åŒºåŸŸéƒ½æœ‰å¯èƒ½ä¼šå‘ç”Ÿ OutOfMemoryErrorï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å®é™…éªŒè¯ä¸€ä¸‹è¿™äº›å¯¹åº”çš„åŒºåŸŸçš„å‘ç”Ÿå¼‚å¸¸çš„å®é™…æƒ…å†µã€‚æˆ‘ä»¬æ¨¡æ‹Ÿå¯¹é¥®åŒºåŸŸçš„å¼‚å¸¸æƒ…å†µæœ‰ä¸¤ä¸ªç›®çš„ï¼š</p><ol><li>ä¸€æ˜¯é€šè¿‡ä»£ç æˆ‘ä»¬èƒ½å¤ŸéªŒè¯ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å„ä¸ªåŒºåŸŸå­˜å‚¨çš„å†…å®¹ã€‚</li><li>é€šè¿‡æ¨¡æ‹Ÿå¼‚å¸¸çš„å¤ç°ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åœ¨å®é™…å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å¼‚å¸¸çš„æç¤ºä¿¡æ¯è¿…é€Ÿå¾—çŸ¥æ˜¯å“ªä¸ªåŒºåŸŸå‡ºç°äº†å†…å­˜æº¢å‡ºï¼ŒçŸ¥é“ä»€ä¹ˆæ ·çš„ä»£ç å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä»¥åŠå†…å­˜æº¢å‡ºä¹‹åæˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†ã€‚</li></ol><h3 id="_1-java-å †æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#_1-java-å †æº¢å‡º" aria-hidden="true">#</a> 1. Java å †æº¢å‡º</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹å †ç©ºé—´ï¼Œå †æ˜¯ç”¨æ¥å­˜å‚¨å¯¹è±¡çš„ï¼Œæˆ‘ä»¬åªè¦ä¸æ–­çš„åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¿è¯ GC Roots ä¸å„ä¸ªå¯¹è±¡ä¹‹é—´ä¿æŒæœ‰å¯è¾¾çš„è·¯å¾„æ¥é¿å…è¿™äº›å¯¹è±¡è¢« GC åƒåœ¾å›æ”¶å™¨æ‰«æå›æ”¶æ‰ï¼Œé‚£ä¹ˆéšç€å¯¹è±¡æ•°é‡çš„å¢åŠ æ€»ä¼šè§¦åŠåˆ°å †ç©ºé—´çš„æœ€å¤§å€¼é™åˆ¶ï¼Œä»è€Œå¯¼è‡´å †ç©ºé—´å†…å­˜æº¢å‡ºã€‚</p><p>æˆ‘ä»¬éœ€è¦æ§åˆ¶å˜é‡ï¼Œè°ƒæ•´è¿è¡Œç¨‹åºçš„ VM å‚æ•°ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® <code>-Xmx20m </code> å’Œ <code>-Xms20m </code> ä¸¤ä¸ªå‚æ•°å°†å †ç©ºé—´çš„æœ€å¤§å®¹é‡å’Œæœ€å°å®¹é‡éƒ½è®¾ç½®ä¸º 20M å³å¯é™åˆ¶å †ç©ºé—´çš„è‡ªåŠ¨æ‰©å±•ï¼Œé€šè¿‡ <code>-XX:+HeapDumpOnOutOfMemoryError</code> å‚æ•°å¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºæ—¶ DUMP å‡ºå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ä»¥ä¾¿åç»­è¿›è¡Œåˆ†æã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202205252233378.png" alt="image-20220525223309265"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ä»£ç ï¼Œæ¥æ¨¡æ‹Ÿè®©å †ç©ºé—´å‘ç”Ÿ OOM å¼‚å¸¸</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError
 */</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOOM</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OOMObject</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OOMObject</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OOMObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202205252235291.png" alt="image-20220525223548183"></p><h3 id="_2-è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º" tabindex="-1"><a class="header-anchor" href="#_2-è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º" aria-hidden="true">#</a> 2. è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º</h3><p>æ€»æ‰€ç²¥æ±ï¼ˆå¾ˆæ²³é‡Œï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆæ˜¯ä¸ºäº†è™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³•ï¼ˆå­—èŠ‚ç ï¼‰æœåŠ¡çš„ï¼›</li><li>æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºäº†è™šæ‹Ÿæœºæ‰§è¡Œæœ¬åœ°ï¼ˆ<code>native</code>ï¼‰æ–¹æ³•æœåŠ¡çš„ï¼›</li></ul><p>è€Œåœ¨ ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹è§„èŒƒäº†ä¸¤ç§å¼‚å¸¸ï¼š</p><ol><li>å¦‚æœçº¿ç¨‹ç”³è¯·çš„æ ˆçš„æ·±åº¦å¤§äºè™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œåˆ™ä¼šå‘ç”Ÿ <code>StackOverflowError</code> å¼‚å¸¸ï¼›</li><li>å¦‚æœè™šæ‹Ÿæœºæ ˆ==æ”¯æŒè‡ªåŠ¨æ‰©å±•==ï¼Œæ ˆå†…å­˜åœ¨æ‰©å±•å®¹é‡æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ—¶ï¼Œä¼šå‘ç”Ÿ <code>OutOfMemroyError</code> å¼‚å¸¸ï¼›</li></ol><p>ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®å…è®¸ Java è™šæ‹Ÿæœºè‡ªè¡Œé€‰æ‹©æ˜¯å¦å®ç°æ ˆå†…å­˜è‡ªåŠ¨æ‰©å±•ï¼Œä½†æ˜¯ HotSpot è™šæ‹Ÿæœºçš„é€‰æ‹©æ˜¯ä¸æ”¯æŒæ‰©å±•ï¼Œæ‰€ä»¥é™¤éè™šæ‹Ÿæœºåœ¨åˆ›å»ºçº¿ç¨‹æ—¶å› ä¸ºç”³è¯·ä¸åˆ°è¶³å¤Ÿçš„å†…å­˜è€Œå‡ºç° OutOfMemoryErrorï¼Œå¦åˆ™åœ¨çº¿ç¨‹çš„è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šå› ä¸ºå†…å­˜æ‰©å±•è€Œå‡ºç°å†…å­˜æº¢å‡ºçš„ï¼Œåªä¼šå› ä¸ºæ ˆå®¹é‡ä¸­æ— æ³•å®¹çº³æ–°çš„æ ˆå¸§è€Œå¯¼è‡´ Stackoverflow å¼‚å¸¸ã€‚</p><p>ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ä¸Šé¢çš„ç»“è®ºçš„çœŸå®æ€§ã€‚æˆ‘ä»¬å…ˆä½¿ç”¨å•çº¿ç¨‹çš„å½¢å¼ï¼Œæ¥å®éªŒä¸€ä¸‹æ˜¯å¦ä¼šè®© HotSpot äº§ç”Ÿ OutOfMemoryError ï¼›</p><ul><li>ä½¿ç”¨ <code>-Xss</code> å‚æ•°é™åˆ¶æ ˆå†…å­˜çš„å®¹é‡ï¼Œä½¿æ ˆçš„æ·±åº¦è¾¾åˆ°å¯ç”³è¯·æ ˆçš„æ·±åº¦çš„æœ€å¤§å€¼ï¼ŒæŠ›å‡º StackoverflowError å¼‚å¸¸ï¼Œæˆ‘ä»¬åŒæ—¶æ‰“å°ä¸€ä¸‹å †æ ˆçš„æ·±åº¦ï¼›</li><li>åŒä¸Šçš„æ¡ä»¶é™åˆ¶æ ˆå®¹é‡çš„åŒæ—¶ï¼Œå¢å¤§æ­¤æ–¹æ³•å¸§ä¸­å±€éƒ¨å˜é‡è¡¨çš„é•¿åº¦ï¼ŒæŠ›å‡º StackoverflowError å¼‚å¸¸ï¼Œæˆ‘ä»¬åŒæ—¶æ‰“å°ä¸€ä¸‹å †æ ˆçš„æ·±åº¦ï¼›</li></ul><p>ç¬¬ä¸€ç§ï¼Œæˆ‘ä»¬åˆ©ç”¨æ–¹æ³•é€’å½’æ¥ï¼Œå¢åŠ è¯·æ±‚æ ˆçš„æ·±åº¦</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * VM Args: -Xss128k
 */</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaVMStackSOF</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> stackLength <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stackLength<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">JavaVMStackSOF</span> sof <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaVMStackSOF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sof<span class="token punctuation">.</span><span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;stack length : &quot;</span> <span class="token operator">+</span> sof<span class="token punctuation">.</span>stackLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202205252326003.png" alt="image-20220525232631904"></p><p>ç¬¬äºŒç§ï¼Œå¾€æ–¹æ³•å¸§ä¸­å¢å¤§å±€éƒ¨å˜é‡è¡¨çš„é•¿åº¦ï¼ˆå¤§å°ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * VM Args: -Xss128k
 */</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaVMStackSOF_StackFrameCapacity</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> stackLength <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">long</span> unused1<span class="token punctuation">,</span>  unused2<span class="token punctuation">,</span>  unused3<span class="token punctuation">,</span>  unused4<span class="token punctuation">,</span>  unused5<span class="token punctuation">,</span>  
            unused6<span class="token punctuation">,</span>  unused7<span class="token punctuation">,</span>  unused8<span class="token punctuation">,</span>  unused9<span class="token punctuation">,</span>  unused10<span class="token punctuation">,</span>
            unused11<span class="token punctuation">,</span> unused12<span class="token punctuation">,</span> unused13<span class="token punctuation">,</span> unused14<span class="token punctuation">,</span> unused15<span class="token punctuation">,</span> 
            unused16<span class="token punctuation">,</span> unused17<span class="token punctuation">,</span> unused18<span class="token punctuation">,</span> unused19<span class="token punctuation">,</span> unused20<span class="token punctuation">,</span>
            unused21<span class="token punctuation">,</span> unused22<span class="token punctuation">,</span> unused23<span class="token punctuation">,</span> unused24<span class="token punctuation">,</span> unused25<span class="token punctuation">,</span> 
            unused26<span class="token punctuation">,</span> unused27<span class="token punctuation">,</span> unused28<span class="token punctuation">,</span> unused29<span class="token punctuation">,</span> unused30<span class="token punctuation">,</span>
            unused31<span class="token punctuation">,</span> unused32<span class="token punctuation">,</span> unused33<span class="token punctuation">,</span> unused34<span class="token punctuation">,</span> unused35<span class="token punctuation">,</span> 
            unused36<span class="token punctuation">,</span> unused37<span class="token punctuation">,</span> unused38<span class="token punctuation">,</span> unused39<span class="token punctuation">,</span> unused40<span class="token punctuation">,</span>
            unused41<span class="token punctuation">,</span> unused42<span class="token punctuation">,</span> unused43<span class="token punctuation">,</span> unused44<span class="token punctuation">,</span> unused45<span class="token punctuation">,</span> 
            unused46<span class="token punctuation">,</span> unused47<span class="token punctuation">,</span> unused48<span class="token punctuation">,</span> unused49<span class="token punctuation">,</span> unused50<span class="token punctuation">,</span>
            unused51<span class="token punctuation">,</span> unused52<span class="token punctuation">,</span> unused53<span class="token punctuation">,</span> unused54<span class="token punctuation">,</span> unused55<span class="token punctuation">,</span> 
            unused56<span class="token punctuation">,</span> unused57<span class="token punctuation">,</span> unused58<span class="token punctuation">,</span> unused59<span class="token punctuation">,</span> unused60<span class="token punctuation">,</span>
            unused61<span class="token punctuation">,</span> unused62<span class="token punctuation">,</span> unused63<span class="token punctuation">,</span> unused64<span class="token punctuation">,</span> unused65<span class="token punctuation">,</span> 
            unused66<span class="token punctuation">,</span> unused67<span class="token punctuation">,</span> unused68<span class="token punctuation">,</span> unused69<span class="token punctuation">,</span> unused70<span class="token punctuation">,</span>
            unused71<span class="token punctuation">,</span> unused72<span class="token punctuation">,</span> unused73<span class="token punctuation">,</span> unused74<span class="token punctuation">,</span> unused75<span class="token punctuation">,</span> 
            unused76<span class="token punctuation">,</span> unused77<span class="token punctuation">,</span> unused78<span class="token punctuation">,</span> unused79<span class="token punctuation">,</span> unused80<span class="token punctuation">,</span>
            unused81<span class="token punctuation">,</span> unused82<span class="token punctuation">,</span> unused83<span class="token punctuation">,</span> unused84<span class="token punctuation">,</span> unused85<span class="token punctuation">,</span> 
            unused86<span class="token punctuation">,</span> unused87<span class="token punctuation">,</span> unused88<span class="token punctuation">,</span> unused89<span class="token punctuation">,</span> unused90<span class="token punctuation">,</span>
            unused91<span class="token punctuation">,</span> unused92<span class="token punctuation">,</span> unused93<span class="token punctuation">,</span> unused94<span class="token punctuation">,</span> unused95<span class="token punctuation">,</span> 
            unused96<span class="token punctuation">,</span> unused97<span class="token punctuation">,</span> unused98<span class="token punctuation">,</span> unused99<span class="token punctuation">,</span> unused100<span class="token punctuation">;</span>

        stackLength<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        unused1 <span class="token operator">=</span>  unused2 <span class="token operator">=</span>  unused3 <span class="token operator">=</span>  unused4 <span class="token operator">=</span>  unused5 <span class="token operator">=</span>  
        unused6 <span class="token operator">=</span>  unused7 <span class="token operator">=</span>  unused8 <span class="token operator">=</span>  unused9 <span class="token operator">=</span>  unused10 <span class="token operator">=</span>
        unused11 <span class="token operator">=</span> unused12 <span class="token operator">=</span> unused13 <span class="token operator">=</span> unused14 <span class="token operator">=</span> unused15 <span class="token operator">=</span> 
        unused16 <span class="token operator">=</span> unused17 <span class="token operator">=</span> unused18 <span class="token operator">=</span> unused19 <span class="token operator">=</span> unused20 <span class="token operator">=</span>
        unused21 <span class="token operator">=</span> unused22 <span class="token operator">=</span> unused23 <span class="token operator">=</span> unused24 <span class="token operator">=</span> unused25 <span class="token operator">=</span> 
        unused26 <span class="token operator">=</span> unused27 <span class="token operator">=</span> unused28 <span class="token operator">=</span> unused29 <span class="token operator">=</span> unused30 <span class="token operator">=</span>
        unused31 <span class="token operator">=</span> unused32 <span class="token operator">=</span> unused33 <span class="token operator">=</span> unused34 <span class="token operator">=</span> unused35 <span class="token operator">=</span> 
        unused36 <span class="token operator">=</span> unused37 <span class="token operator">=</span> unused38 <span class="token operator">=</span> unused39 <span class="token operator">=</span> unused40 <span class="token operator">=</span>
        unused41 <span class="token operator">=</span> unused42 <span class="token operator">=</span> unused43 <span class="token operator">=</span> unused44 <span class="token operator">=</span> unused45 <span class="token operator">=</span> 
        unused46 <span class="token operator">=</span> unused47 <span class="token operator">=</span> unused48 <span class="token operator">=</span> unused49 <span class="token operator">=</span> unused50 <span class="token operator">=</span>
        unused51 <span class="token operator">=</span> unused52 <span class="token operator">=</span> unused53 <span class="token operator">=</span> unused54 <span class="token operator">=</span> unused55 <span class="token operator">=</span> 
        unused56 <span class="token operator">=</span> unused57 <span class="token operator">=</span> unused58 <span class="token operator">=</span> unused59 <span class="token operator">=</span> unused60 <span class="token operator">=</span>
        unused61 <span class="token operator">=</span> unused62 <span class="token operator">=</span> unused63 <span class="token operator">=</span> unused64 <span class="token operator">=</span> unused65 <span class="token operator">=</span> 
        unused66 <span class="token operator">=</span> unused67 <span class="token operator">=</span> unused68 <span class="token operator">=</span> unused69 <span class="token operator">=</span> unused70 <span class="token operator">=</span>
        unused71 <span class="token operator">=</span> unused72 <span class="token operator">=</span> unused73 <span class="token operator">=</span> unused74 <span class="token operator">=</span> unused75 <span class="token operator">=</span> 
        unused76 <span class="token operator">=</span> unused77 <span class="token operator">=</span> unused78 <span class="token operator">=</span> unused79 <span class="token operator">=</span> unused80 <span class="token operator">=</span>
        unused81 <span class="token operator">=</span> unused82 <span class="token operator">=</span> unused83 <span class="token operator">=</span> unused84 <span class="token operator">=</span> unused85 <span class="token operator">=</span> 
        unused86 <span class="token operator">=</span> unused87 <span class="token operator">=</span> unused88 <span class="token operator">=</span> unused89 <span class="token operator">=</span> unused90 <span class="token operator">=</span>
        unused91 <span class="token operator">=</span> unused92 <span class="token operator">=</span> unused93 <span class="token operator">=</span> unused94 <span class="token operator">=</span> unused95 <span class="token operator">=</span> 
        unused96 <span class="token operator">=</span> unused97 <span class="token operator">=</span> unused98 <span class="token operator">=</span> unused99 <span class="token operator">=</span> unused100 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;stack length : &quot;</span> <span class="token operator">+</span> stackLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202205262229643.png" alt="image-20220526222927534"></p><p>ä»ä¸Šé¢ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ˜¯æ ˆå¸§è¿‡å¤§æˆ–è€…æ˜¯æ ˆå†…å­˜å¤ªå°ï¼Œå½“æ–°çš„æ ˆå¸§æ— æ³•åˆ†é…å†…å­˜çš„æ—¶å€™ï¼ŒHotSpot éƒ½ä¼šæŠ›å‡º Stackoverflow å¼‚å¸¸ã€‚</p><p><strong>ç‰¹æ®Š</strong>ï¼šåˆ›å»ºçº¿ç¨‹å¯¼è‡´å†…å­˜æº¢å‡ºå¼‚å¸¸</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * VM Args: -Xss2M
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaVMStackOOM</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dontStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stackLeaBbyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">dontStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JavaVMStackOOM</span> oom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaVMStackOOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        oom<span class="token punctuation">.</span><span class="token function">stackLeaBbyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„ï¼š</p><p>è¿™ä¸ªä»£ç  ==ä¸è¦éšä¾¿è¿è¡Œï¼ï¼ï¼== ==ä¸è¦éšä¾¿è¿è¡Œï¼ï¼ï¼== ==ä¸è¦éšä¾¿è¿è¡Œï¼ï¼ï¼==</p><p>é™¤éä½ ä¿å­˜å¥½äº†ä½ å½“å‰çš„é‚£äº›å·¥ä½œçš„æƒ…å†µä¸‹ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åœ¨æ“ä½œç³»ç»Ÿä¸Šçš„ï¼Œæ— é™åˆ¶çš„åˆ›å»ºçº¿ç¨‹ä¼šç»™æ“ä½œç³»ç»Ÿç›¸å½“å¤§çš„å‹åŠ›ï¼Œä¼šæ­»æœºï¼ï¼ˆæˆ‘å°±æ˜¯çŸ¥é“ğŸ¤£</p><p>è¿˜æœ‰å°±æ˜¯ï¼Œæˆ‘åœ¨ 64 ä½çš„æ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œäº†ä»£ç ä½†æ˜¯çŸ¥é“ç”µè„‘èŠœæ¹–~èµ·é£åˆ°æ­»æœºï¼Œæˆ‘ä»»ç„¶æ²¡æœ‰çœ‹åˆ°è™šæ‹ŸæœºæŠ›å‡º OutOfMemoryError å¼‚å¸¸ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å“ªé‡Œå‡ºé”™äº†ï¼Œæœ‰å¾…åç»­è£…ä¸€ä¸ª 32 ä½çš„æ“ä½œç³»ç»Ÿå†æ¥éªŒè¯ï¼ˆå…ˆæŒ–ä¸ªå‘ğŸ¤”ğŸ˜ï¼‰</p></blockquote><h3 id="_3-æ–¹æ³•åŒº-å…ƒç©ºé—´-å’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#_3-æ–¹æ³•åŒº-å…ƒç©ºé—´-å’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º" aria-hidden="true">#</a> 3.æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰å’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º</h3><p>ç”±äºè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªåŒºåŸŸå¯ä»¥æ”¾åˆ°ä¸€èµ·æ¥éªŒè¯ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä¸€å¹¶éªŒè¯ï¼š<code>JDK 7</code> å¼€å§‹çš„å»æ°¸ä¹…å¸¦è®¡åˆ’ï¼Œåœ¨ <code>JDK 8</code> å®Œæˆï¼Œä½¿ç”¨å…ƒç©ºé—´ä»£æ›¿äº†ä¹‹å‰ç‰ˆæœ¬çš„æ°¸ä¹…å¸¦ä½œä¸ºæ–¹æ³•åŒºçš„å®ç°ï¼Œçœ‹çœ‹å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸æ˜¯ç§»åˆ°äº†å †ä¸­</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * JDK6: VM Args: -XX:PermSize=6M -XX:MaxPermSize=6M
 * JDK8: VM Args: -Xmx6M -Xms6M
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeConstantPoolOOM</span> <span class="token punctuation">{</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
        <span class="token keyword">short</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202206062134511.png" alt="image-20220606213410321"></p><p>å‡ºç°ä¸Šè¿°åŸå› æ˜¯å› ä¸ºè‡ª <code>JDK 7</code> å¼€å§‹åŸæœ¬ä½äºæ–¹æ³•åŒºä¸­çš„å­—ç¬¦åºŠå¸¸é‡æ± æ˜¯è¢«ç§»åˆ°æ”¾åˆ°äº†å †ä¸­ï¼Œæ‰€ä»¥é™åˆ¶å †å¤§å°å¾€å¸¸é‡æ± ä¸­ä¸æ–­çš„æ·»åŠ å¸¸é‡ä¼šé€ æˆå¸¸é‡æ± å†…å­˜æº¢å‡ºï¼›</p><p>å…³äºå­—ç¬¦ä¸²å¸¸é‡æ± çš„å®ç°å‡ºç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜èƒ½å¼•ç”³å‡ºä¸€äº›æ›´æœ‰è¶£çš„å½±å“ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeConstantPoolOOM</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;Code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Learning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;ja&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;va&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// true</span>
<span class="token comment">// false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,74),d={href:"https://www.zhihu.com/question/51102308/answer/124441115",target:"_blank",rel:"noopener noreferrer"},r=a(`<h3 id="_4-æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#_4-æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º" aria-hidden="true">#</a> 4.æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * VM Args: -Xmx5M -XX:MaxDirectMemorySize=1M
 * <span class="token keyword">@author</span> xiongjun
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectMemoryOOM</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Field</span> field <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;theUnsafe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Unsafe</span><span class="token punctuation">)</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            unsafe<span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>_1MB<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/LZTGD4V$EY1X34T$33M~J44.png" alt=""></p><h2 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h2><p>è¿è¡Œæ—¶æ•°æ®åŒºçš„å†…å®¹åŸºæœ¬åˆ°è¿™é‡Œå°±æ€»ç»“çš„å·®ä¸å¤šäº†ï¼Œè¿™ç« ä¸»è¦å¯¹è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºä¸­çš„å„ä¸ªå…·ä½“åŒºåŸŸçš„ä½œç”¨ï¼ŒåŠŸèƒ½è¿›è¡Œäº†äº†è§£ï¼Œè™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å¼æ›´æ¸…æ™°å…·åƒåŒ–äº†ï¼›ç„¶åå¯¹ Java å¯¹è±¡çš„ï¼šåˆ›å»ºè¿‡ç¨‹ï¼ˆç±»çš„æ£€æµ‹åŠ è½½ã€å†…å­˜åˆ†é…ã€åˆå§‹åŒ–é›¶å€¼ã€è®¾ç½®å¯¹è±¡å¤´ã€æ‰§è¡Œinit&lt;&gt;() æ–¹æ³•ï¼‰ï¼Œå†…å­˜å¸ƒå±€ï¼Œè®¿é—®å®šä½è¿›äº†å­¦ä¹ ï¼Œæœ€åæ˜¯å¯¹å„ä¸ªåŒºåŸŸè¿›è¡Œäº†é€æ­¥çš„å†…å­˜æº¢å‡ºæµ‹è¯•ã€‚</p>`,5);function k(v,m){const e=t("ExternalLinkIcon");return o(),c("div",null,[i,n("p",null,[s('è¿™é‡Œä¼šæåˆ° String çš„ intern() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†å­—ç¬¦åºŠåŠ å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œåœ¨ JDK 7 ä¹‹åå­—ç¬¦åºŠå¸¸é‡æ± å­˜åœ¨äº Java å †ä¸­ï¼Œæ‰€ä»¥ intern() ä»…ä»…éœ€è¦è®°å½•ä¸€ä¸‹æŸä¸ªå­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„å¼•ç”¨å³å¯ï¼ˆæ„æ€å°±æ˜¯ï¼Œåœ¨è°ƒç”¨ intern æ–¹æ³•æ—¶ï¼Œä¼šå…ˆå»å¸¸é‡æ± ä¸­æœç´¢ä¸€ç•ªï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²æ²¡æœ‰åœ¨å¸¸é‡æ± ä¸­ï¼Œé‚£ä¹ˆå°±å°†è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨æ·»åŠ åˆ°å¸¸é‡æ± ä¸­ï¼Œåœ¨è¿”å›è¯¥å¼•ç”¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ str1 çš„æ‰§è¡Œç»“æœä¸º true çš„åŸå› ï¼Œè‡³äºä¸ºç”šä¹ˆ str2 ä¸º false æ˜¯å› ä¸ºï¼Œ"java" è¿™ä¸ªå­—ç¬¦åºŠå¹¶ç¬¦åˆâ€œé¦–æ¬¡å‡ºç°â€è¿™ä¸ªåŸåˆ™ï¼Œä¹‹å‰å°±è¢«åŠ è½½äº†ï¼Œè‡³äºæ˜¯ä»€ä¹ˆæ—¶å€™è¢«åŠ è½½çš„ï¼Œ'),n("a",d,[s("å¯ä»¥çœ‹ä¸‹è¿™é‡Œ"),u(e)])]),r])}const g=p(l,[["render",k],["__file","jvm-memoryarea.html.vue"]]);export{g as default};
